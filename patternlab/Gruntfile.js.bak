module.exports = function(grunt) {

  // Configuration
  grunt.initConfig({
    pkg: grunt.file.readJSON('package.json'),
    shell: {
      patternlab: {
        command: "php core/builder.php -gp"
      },
      rsync_css: {
        command: "rsync -vr public/css/ source/css/"
      },
    },
    sass: {
      options: {
        debugInfo: true
      },
      dist: {
        options: {
            style: 'compressed'
        },
        files: {
            'public/css/style.css': 'source/css/style.scss',
            'public/styleguide/css/styleguide.css': 'public/styleguide/css/styleguide.scss',
            'public/styleguide/css/styleguide-specific.css': 'public/styleguide/css/styleguide-specific.scss'
        }
      }
    },
    concat: {
      js_plugins: {
          src: [
              'source/js/plugins/*.js'
          ],
          dest: 'source/js/plugins.js'
      },
      js: {
          src: [
              'source/js/src/*.js'
          ],
          dest: 'source/js/main.js'
      }
    },
    uglify: {
      js_plugins: {
          files: {
              'source/js/plugins.min.js' : ['source/js/plugins.js']
          }
      },
      js: {
          files: {
              'source/js/main.min.js' : ['source/js/main.js']
          }
      },
    },
    connect: {
      server: {
        options: {
          port: 8080,
          hostname: 'localhost',
          base: 'public/'
        }
      }
    },
    watch: {
      html: {
          files: [
            'source/_patterns/**/*.mustache',
            'source/_patterns/**/*.json',
            'source/_data/*.json',
          ],
          tasks: [ 'shell:patternlab' ],
      },
      js_plugins: {
          files: 'source/js/plugins/*.js',
          tasks: ['concat', 'uglify'],
      },
      js: {
          files: 'source/js/src/*.js',
          tasks: ['concat', 'uglify'],
      },
      css: {
          files: [ 'source/css/*.scss', 'source/css/**/*.scss', 'public/styleguide/css/**/*.scss' ],
          //tasks: [ 'sass', 'shell:rsync_css' ],
          tasks: [ 'sass' ],
      },
      options: {
          spawn: false,
          livereload: true
      }
    }
  });

  // Plugins
  grunt.loadNpmTasks('grunt-shell');
  grunt.loadNpmTasks('grunt-contrib-concat');
  grunt.loadNpmTasks('grunt-contrib-uglify');
  grunt.loadNpmTasks('grunt-contrib-sass');
  grunt.loadNpmTasks('grunt-contrib-connect');
  grunt.loadNpmTasks('grunt-contrib-watch');

  // Tasks
  grunt.registerTask('default', [ 'connect', 'concat:js', 'uglify:js', 'concat:js_plugins', 'uglify:js_plugins', 'sass','shell:patternlab', 'watch' ]);
};